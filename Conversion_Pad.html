<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="css/conversion_pad_style.css">
    <meta charset="UTF-8">
    <title>换算面板</title>
</head>

<body>
    <div id='main_container'>
        <div class="container">
            <div class="sidebar">
                <div class="toggle-button" id="toggleButton">
                    <img src="images/icons/Right.svg" alt="Toggle Button" style="width: 25px;" />
                </div>
                <div class="user-info">
                    <img src="images/avatars/avatar-1.jpg" alt="User Avatar">
                    <span class="username">Jakie Ma</span>
                </div>
                <div class="options">
                    <div class="option">
                        <img src="images/icons/Weight_conv.svg" alt="重量转换">
                        <div class="option_text">重量转换</div>
                    </div>
                    <div class="option">
                        <img src="images/icons/Down.svg" alt="个数转换">
                        <div class="option_text">个数转换</div>
                    </div>
                    <div class="option">
                        <img src="images/icons/Size_conv.svg" alt="尺寸转换">
                        <div class="option_text">尺寸转换</div>
                    </div>
                    <div class="option">
                        <img src="images/icons/Community.svg" alt="兴趣社区">
                        <div class="option_text">兴趣社区</div>
                    </div>
                    <div class="option" id="numpad_exp_fold" onclick="exp_fold_numpad()">
                        <img src="images/icons/numpad.svg" alt="收起/展开数字键盘">
                        <div class="option_text">收起/展开数字键盘</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="center-div">
            <div id="input_area" onclick="switch_to_input_area()">
                <div class="search_bar" onclick="toggle_input_search_panel()">
                    <div style="color: black;font-size: 75%"><img src="images/icons/Search.svg"><span>搜索</span></div>
                </div>
                <div id="input_search_panel" class="embedded-content">
                    <iframe src="Input_Search_Panel.html" frameborder="0" width="80%" height="100%"></iframe>
                </div>
                <div id="input_display"
                    style="position: absolute; left:95%; top: 75%; transform: translate(-100%,-50%);font-size: 30px; text-align: right; color: black;">
                </div>
                <div id="input_item_name"
                    style="position: relative;left: 5%; top:20%;font-size: 30px;text-align: left;color: black;"></div>
            </div>
            <div id="iframe-container">
                <iframe id= 'cmd_panel' src="Command_Panel.html" style="width: 40vw; height: 40vw;border-radius: 2vh;"></iframe>
                <div id="cmd_panel_background"></div>
            </div>
            <div id="output_area">
                <div class="search_bar" onclick="toggle_output_search_panel()">
                    <div style="color: black;font-size: 75%"><img src="images/icons/Search.svg"><span>搜索</span>
                    </div>
                </div>
                <div id="output_search_panel" class="embedded-content">
                    <iframe src="Output_Search_Panel.html" frameborder="0" width="80%" height="100%"></iframe>
                </div>
                <div id="result_display"
                    style="position: absolute; left:95%; top: 75%; transform: translate(-100%,-50%);font-size: 30px; text-align: right; color: black;">
                </div>
                <div id="output_item_name"
                    style="position: relative; left: 5%; top:20%;font-size: 30px;text-align: left;color: black;">
                </div>
            </div>
            <div class="numpad_area" id="numpad_area">
                <div onclick="input(1)">1</div>
                <div onclick="input(2)">2</div>
                <div onclick="input(3)">3</div>
                <div onclick="backspace()">←</div>
                <div onclick="input(4)">4</div>
                <div onclick="input(5)">5</div>
                <div onclick="input(6)">6</div>
                <div onclick="by_text()">⌘</div>
                <div onclick="input(7)">7</div>
                <div onclick="input(8)">8</div>
                <div onclick="input(9)">9</div>
                <div onclick="clean_all()">AC</div>
                <div onclick="input(0)">0</div>
                <div onclick="decimal_dot()">.</div>
                <div onclick="ans()">=</div>
            </div>
        </div>
    </div>
</body>
<script>
    function clean_all() {
        document.getElementById('input_display').textContent = '';
        document.getElementById('result_display').textContent = '';
    }
    function input(num) {
        var display = document.getElementById('input_display');
        var current_value = display.textContent;
        if (current_value === '0' && num === '0') {
            display.textContent = '2 zero mistake';//不重复添加0
            return;
        }
        display.textContent = current_value + num;
    }
    function decimal_dot() {
        var display = document.getElementById('input_display');
        var current_value = display.textContent;
        if (current_value.includes('.')) {
            display.textContent = '2 decimal dots mistake';
            return;
        }
        display.textContent += '.'
    }
    function ans() {
        var result_display = document.getElementById('result_display');
        var input_item_name = document.getElementById('input_item_name');
        var input_number = parseFloat(document.getElementById('input_display'));
        result_display.textContent = 363000000000;
    }
    function backspace() {
        var display = document.getElementById('input_display');
        current_value = display.textContent;
        length = current_value.length - 1;
        current_value = current_value.slice(0, length);
        display.textContent = current_value;
    }
    function by_text() {
        var iframe = document.getElementById('cmd_panel');
        var background = document.getElementById('cmd_panel_background');
        var container = document.getElementById('iframe-container');

        // 显示iframe和背景遮罩
        iframe.style.display = 'block';
        background.style.display = 'block';
        container.style.display = 'block';
    }
    function toggle_input_search_panel() {
        var content = document.getElementById('input_search_panel');
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
    }
    function toggle_output_search_panel() {
        var content = document.getElementById('output_search_panel');
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
    }


    var keyboard = document.getElementById('numpad_area');
    var toggleButton = document.getElementById('numpad_exp_fold');

    // 监听按钮点击事件
    toggleButton.addEventListener('click', function () {
        // 切换键盘的类，以控制显示和隐藏
        if (keyboard.classList.contains('expanded')) {
            keyboard.classList.remove('expanded');
        } else {
            keyboard.classList.add('expanded');
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        const sidebar = document.querySelector('.sidebar');
        const toggleButton = document.getElementById('toggleButton');

        // 展开侧边栏并旋转图标
        function expandSidebar() {
            sidebar.classList.add('expanded');
            toggleButton.style.animation = 'rotate 0.3s forwards';
        }

        // 收起侧边栏并重置图标
        function collapseSidebar() {
            sidebar.classList.remove('expanded');
            toggleButton.style.animation = 'rotate 0.3s reverse';
        }

        // 切换侧边栏状态
        toggleButton.addEventListener('click', function () {
            if (sidebar.classList.contains('expanded')) {
                collapseSidebar();
            } else {
                expandSidebar();
            }
        });
    });

    // 监听来自iframe的消息
    window.addEventListener('message', function (event) {
        // 检查消息的来源和数据结构
        if (event.data && event.data.action === 'update_input_item_name') {
            // 更新父页面的内容
            document.getElementById('input_item_name').textContent = event.data.text;
        }
        if (event.data && event.data.action === 'update_output_item_name' && document.getElementById('input_item_name').textContent != NaN) {
            // 更新父页面的内容
            document.getElementById('output_item_name').textContent = event.data.text;
        }
    }, false); 
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var params = new URLSearchParams(window.location.search);
        document.getElementById('input_item_name').textContent = params.get('input_item_name');
        document.getElementById('output_item_name').textContent = params.get('output_item_name');
    });
</script>
